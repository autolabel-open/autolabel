import os
import random
import time

import requests

target_url = os.environ.get("TARGET_URL", None)

if target_url is None:
    print("TARGET_URL is not set")
    exit(1)

print(target_url)


def normal_cve_2020_9496():
    # 定义请求的headers
    headers = {
        "Accept-Encoding": "gzip, deflate, br",
        "Accept": "*/*",
        "Accept-Language": "en-US;q=0.9,en;q=0.8",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.127 Safari/537.36",
        "Connection": "close",
        "Cache-Control": "max-age=0",
        "Content-Type": "application/xml",
    }

    xml = f"""<?xml version="1.0"?>
    <methodCall>
      <methodName>testXmlRpcAdd</methodName>
      <params>
        <param>
          <value>
 <int>{random.randint(0,999)}</int>
          </value>
        </param>
        <param>
          <value>
 <int>{random.randint(0,999)}</int>
          </value>
        </param>
      </params>
    </methodCall>
    """
    res = requests.post(
        f"{target_url}/webtools/control/xmlrpc",
        headers=headers,
        data=xml,
        verify=False,
    )
    print(res.text)


time.sleep(15)
epoch = 0
start_time = time.time()
while True:
    epoch += 1
    cur_time = time.time()
    runtime = cur_time - start_time
    time.sleep(3)
    if runtime < epoch:
        time.sleep(epoch - (cur_time - start_time))
    try:
        normal_cve_2020_9496()
    except:
        pass
